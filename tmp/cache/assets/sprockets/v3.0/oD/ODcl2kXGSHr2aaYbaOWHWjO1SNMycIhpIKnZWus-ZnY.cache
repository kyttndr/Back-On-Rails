I"þ(function() {
  $(window).load(function() {
    return window.initMap();
  });

  $(document).on('turbolinks:load', function() {
    return window.initMap();
  });

  jQuery(function() {
    return window.initMap = function() {
      var getAddress, i, ipLookUp, map, marker;
      map = new google.maps.Map(document.getElementById('map'), {
        center: {
          lat: 43.66090860000001,
          lng: -79.39595179999999
        },
        zoom: 13
      });
      ipLookUp = function() {
        $.ajax('https://ip-api.com/json').then((function(response) {
          console.log('User\'s Location Data is ', response);
          console.log('User\'s Country', response.country);
          getAdress(response.lat, response.lon);
        }), function(data, status) {
          console.log('Request failed.  Returned status of', status);
        });
      };
      getAddress = function(latitude, longitude) {
        $.ajax('https://maps.googleapis.com/maps/api/geocode/json?latlng=' + latitude + ',' + longitude + '&key=AIzaSyDw0kMkVGzNTppK2U4lsn_65sakVTCR1Mc').then((function(response) {
          console.log('User\'s Address Data is ', response['results'][0]['formatted_address']);
        }), function(status) {
          console.log('Request failed.  Returned status of', status);
        });
      };
      if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition((function(position) {
          getAddress(position.coords.latitude, position.coords.longitude);
        }), function(error_message) {
          console.error('An error has occured while retrieving location', error_message);
          ipLookUp();
        });
      } else {
        console.log('geolocation is not enabled on this browser');
        ipLookUp();
      }
      i = 0;
      while (i < gon.places.length) {
        marker = new google.maps.Marker({
          position: {
            lat: gon.places[i].latitude,
            lng: gon.places[i].longitude
          },
          title: gon.places[i].address,
          map: map,
          animation: google.maps.Animation.DROP,
          url: '/places/' + gon.places[i].id
        });
        marker.addListener('click', function() {
          window.location.href = this.url;
        });
        i++;
      }
    };
  });

}).call(this);
:ET