<h1>PENDING TRANSACTIONS</h1>

<%= render 'error_messages' %>

<p>
<div>ACCEPT OR REJECT APPLICATIONS TO BORROW YOUR ITEMS</div>
<table>
	<tr>
		<th>Item</th>
		<th>Description</th>
		<th>Borrower</th>
        <th>Start Date</th>
        <th>End Date</th>
	</tr>
    <% @pending_lend_transactions.each do |transaction|%>
        <tr>
			<td><%= link_to "#{transaction.item.name}", item_path(transaction.item) %></td>
            <td><%= transaction.item.description %></td>
			<td><%= link_to "#{transaction.borrower.username}", user_path(transaction.borrower) %></td>
            <td><%= transaction.start_date%></td>
            <td><%= transaction.end_date%></td>

			<% params_approved = {isApproved: 1, redirect: pending_transactions_path, render: pending_transactions_path} %>
			<% params_rejected = {isApproved: 2, redirect: pending_transactions_path, render: pending_transactions_path} %>
            <td><%= link_to 'accept', transaction_path(transaction, transaction: params_approved, item_id: transaction.item), method: :put %></td>
            <td><%= link_to 'reject', transaction_path(transaction, transaction: params_rejected, item_id: transaction.item), method: :put %></td>
        </tr>
    <% end %>
</table>
</p>


<p>
<div>YOUR PENDING BORROW REQUESTS that have not been accepted yet</div>
<table>
	<tr>
		<th>Item</th>
		<th>Description</th>
		<th>Owner</th>
        <th>Start Date</th>
        <th>End Date</th>
	</tr>
    <% @pending_borrow_transactions.each do |transaction|%>
        <tr>
			<td><%= link_to "#{transaction.item.name}", item_path(transaction.item) %></td>
            <td><%= transaction.item.description %></td>
			<td><%= link_to "#{transaction.lender.username}", user_path(transaction.lender) %></td>
            <td><%= transaction.start_date%></td>
            <td><%= transaction.end_date%></td>
            <% query_params = {item_id: transaction.item} %>
            <td><%= link_to 'edit', edit_transaction_path(transaction, query_params) %></td>
			<% params = {redirect: pending_transactions_path} %>
			<td><%= link_to 'cancel transaction', transaction_path(transaction, transaction: params), method: :delete %></td>
        </tr>
    <% end %>
</table>
</p>

<p>
<div>YOUR REJECTED REQUESTS TO BORROW OTHER USERS' ITEMS</div>
<table>
	<tr>
		<th>Item</th>
		<th>Description</th>
		<th>Owner</th>
        <th>Start Date</th>
        <th>End Date</th>
	</tr>
    <% @borrow_transactions.each do |transaction|%>
        <% if transaction.isApproved == 2%>
            <tr>
				<td><%= link_to "#{transaction.item.name}", item_path(transaction.item) %></td>
                <td><%= transaction.item.description %></td>
				<td><%= link_to "#{transaction.lender.username}", user_path(transaction.lender) %></td>
                <td><%= transaction.start_date%></td>
                <td><%= transaction.end_date%></td>
            </tr>
        <% end %>
    <% end %>
</table>
</p>


<div>
<%=link_to 'home', root_path%>
</div>
